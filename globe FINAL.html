<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Minimal Globe with Markers</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background-color: black;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
    }
    #globeViz {
      position: absolute;
      top: 60px;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>
<body>

 <div id="controls">
  <label for="dimensionFilter">Dimension</label><br/>
  <select id="dimensionFilter">
    <option value="value_1">Econ√≥mica</option>
    <option value="value_2">Blanda</option>
    <option value="value_3">Global</option>
  </select><br/><br/>

  <label for="countryFilter">Country of destination</label><br/>
  <select id="countryFilter">
    <option value="All">All countries</option>
  </select>
</div>

  <div id="globeViz"></div>

  <!-- Required libraries -->
  <script src="https://unpkg.com/three"></script>
  <script src="https://unpkg.com/globe.gl"></script>

  <!-- Your data file (must define const allArcs = [...]; ) -->
  <script src="arcsData_multi_value.js"></script>

 <script>
  console.log("Loaded arcs:", allArcs);

  const globe = Globe()
    .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
    .arcLabel(d => `${d.label}: ${d.value.toFixed(2)}`)
    .arcStartLat(d => d.startLat)
    .arcStartLng(d => d.startLng)
    .arcEndLat(d => d.endLat)
    .arcEndLng(d => d.endLng)
    .arcAltitude(0)
    .arcStroke(d => 0.1 + d.value * 0.08)
    .arcColor(d => d.color || 'orange')
    .arcDashLength(0.4)
    .arcDashGap(1)
    .arcDashInitialGap(() => Math.random() * 2)
    .arcDashAnimateTime(3000)
    .pointLat(d => d.lat)
    .pointLng(d => d.lng)
    .pointColor(d => d.color)
    .pointAltitude(0)
    .pointRadius(d => d.size || 0.2)
    .pointLabel(d => d.label)

    (document.getElementById('globeViz'));

  // Populate country filter
  const countryFilter = document.getElementById('countryFilter');
  const countries = Array.from(new Set(allArcs.map(d => d.end_country))).sort();
  countries.forEach(country => {
    const option = document.createElement('option');
    option.value = country;
    option.textContent = country;
    countryFilter.appendChild(option);
  });

  function updateGlobe() {
    const dimension = document.getElementById('dimensionFilter').value;
    const selectedCountry = countryFilter.value;

    const filtered = allArcs
      .map(d => ({
        ...d,
        value: d[dimension],
        color: dimension === 'value_1' ? 'red' :
               dimension === 'value_2' ? 'blue' :
               'green'
      }))
      .filter(d =>
        d.value > 0 &&
        (selectedCountry === 'All' || d.end_country === selectedCountry)
      );

    const endPoints = filtered.map(d => ({
      lat: d.endLat,
      lng: d.endLng,
      size: 0.3 + d.value * 0.01,
      color: d.color,
      label: d.label
    }));

    globe.arcsData(filtered);
    globe.pointsData(endPoints);
  }

  document.getElementById('dimensionFilter').addEventListener('change', updateGlobe);
  document.getElementById('countryFilter').addEventListener('change', updateGlobe);

  // Initial render
  updateGlobe();
</script>
